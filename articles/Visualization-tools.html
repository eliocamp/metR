<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visualization tools • metR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualization tools">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.18.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Visualization-tools.html">Visualization tools</a></li>
    <li><a class="dropdown-item" href="../articles/Working-with-data.html">Working with data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/eliocamp/metR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Visualization tools</h1>
                        <h4 data-toc-skip class="author">Elio
Campitelli</h4>
            
            <h4 data-toc-skip class="date">2025-09-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/eliocamp/metR/blob/main/vignettes/Visualization-tools.Rmd" class="external-link"><code>vignettes/Visualization-tools.Rmd</code></a></small>
      <div class="d-none name"><code>Visualization-tools.Rmd</code></div>
    </div>

    
    
<p>One of the “conceptual branches” of <code>metR</code> is the
<em>visualization tools</em>. These are a set of functions that
interface with <a href="https://ggplot2.tidyverse.org/index.html" class="external-link">ggplot2</a> for easier
and better plotting of meteorological (an other) fields.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Packages and data use throught </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://eliocamp.github.io/metR/">metR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">copy</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">)</span></span>
<span><span class="va">temperature</span><span class="op">[</span>, <span class="va">air.z</span> <span class="op">:=</span> <span class="fu"><a href="../reference/Anomaly.html">Anomaly</a></span><span class="op">(</span><span class="va">air</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">lat</span>, <span class="va">lev</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="section level2">
<h2 id="geoms-and-stats">Geoms and stats<a class="anchor" aria-label="anchor" href="#geoms-and-stats"></a>
</h2>
<div class="section level3">
<h3 id="geom_contour_fill">geom_contour_fill()<a class="anchor" aria-label="anchor" href="#geom_contour_fill"></a>
</h3>
<p>This geom has a bit of a long story. Before ggplot2 introduced
<code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour_filled()</a></code>, the ‘canonical’ way to get filled
contours was by using <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">stat_contour()</a></code> with a
<code>polygon</code> geom and mapping <code>fill</code> to
<code>level</code> (see <a href="https://github.com/tidyverse/ggplot2/issues/1066" class="external-link">this</a> issue).
This was ugly and bad and didn’t work in most cases, so I threw together
some hacks to make it work, and thus
<code><a href="../reference/geom_contour_fill.html">metR::geom_contour_fill()</a></code> was born.</p>
<p>Then, Claus Wilke created {<a href="https://github.com/r-lib/isoband" class="external-link">isoband</a>}, which lead to
ggplot2 finally getting a proper implementation of filled contours.
Since the implementation worked much better than my Frankenstein’s
monster hacks and workarounds, I decided to scrub it and adopt {isoband}
as well.</p>
<p>So after all this history the R landscape is left with
<code><a href="../reference/geom_contour_fill.html">metR::geom_contour_fill()</a></code> and
<code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">ggplot2::geom_contour_filled()</a></code> with almost identical
implementations. Why should you use one or the other? Why didn’t I just
deprecate this seemingly redundant function? Because, in the intervening
time <code><a href="../reference/geom_contour_fill.html">metR::geom_contour_fill()</a></code> has evolved and it now
provides many functionality that is missing from ggplot2’s
counterpart.</p>
<div class="section level4">
<h4 id="breaks-can-be-a-function-">
<code>breaks</code> can be a function.<a class="anchor" aria-label="anchor" href="#breaks-can-be-a-function-"></a>
</h4>
<p>The main control parameter of the contour family of functions it
their <code>breaks</code> argument, which sets the levels at which to
draw contour lines. In <code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> this argument
can be a function that takes a binwidth and the range of the data. This
allows for great flexibility.</p>
<p>For example, is is very common in meteorological science to not draw
contours at the zero level. Passing <code><a href="../reference/MakeBreaks.html">MakeBreaks()</a></code> as the
<code>breaks</code> argument allows you to control not only the
binwidth, but also which levels <strong>not</strong> to draw.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lon</span> <span class="op"><a href="../reference/logic.html">%~%</a></span> <span class="fl">180</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lat</span>, <span class="va">lev</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>, exclude <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span>, exclude <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="infilling-of-missing-values">Infilling of missing values<a class="anchor" aria-label="anchor" href="#infilling-of-missing-values"></a>
</h4>
<p>Both <code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> and
<code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour_filled()</a></code> will work fine with missing values,
but they will leave a somewhat ugly empty patch when they are found.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span></span>
<span><span class="va">volcano</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">volcano</span><span class="op">[</span>, <span class="va">value.gap</span> <span class="op">:=</span> <span class="va">value</span><span class="op">]</span></span>
<span><span class="va">volcano</span><span class="op">[</span><span class="op">(</span><span class="va">Var1</span> <span class="op">-</span> <span class="fl">40</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">Var2</span> <span class="op">-</span> <span class="fl">35</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">&lt;</span> <span class="fl">50</span>, <span class="va">value.gap</span> <span class="op">:=</span> <span class="cn">NA</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">volcano</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span>, z <span class="op">=</span> <span class="va">value.gap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>This is an OK behaviour, but sometimes it’s more visually appealing
to fill in these missing areas. The <code>na.fill</code> argument allows
for some control over how this values are imputed. It can take a number,
a function function that takes the vector of values and returns one
number, or <code>TRUE</code>, in which case it will use
<code><a href="../reference/Impute2D.html">metR::Impute2D()</a></code> to interpolate the missing values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">volcano</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span>, z <span class="op">=</span> <span class="va">value.gap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span>na.fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Warning: Imputing missing values.</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="on-the-fly-projecting">On-the-fly projecting<a class="anchor" aria-label="anchor" href="#on-the-fly-projecting"></a>
</h4>
<p>Contouring only works on regular grids (although see {<a href="https://cran.r-project.org/package=contoureR" class="external-link">contoureR</a>} for
an implementation that accepts non-regular girds). Sometimes the data is
regular in some coordinate system and you need to plot in another. For
example, this data is not regular on a a longitude by latitude
coordinate system, but it is regular on the x y coordinates which is a
lambertian grid.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">surface</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">surface</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">surface</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-5-2.png" width="672"></p>
<p>If you know the projection string, you can pass it to the
<code>proj</code> argument and get filled contours in longitude by
latitude space (this needs {<a href="https://cran.r-project.org/package=proj4" class="external-link">proj4</a>} to be
installed).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">proj_string</span> <span class="op">&lt;-</span> <span class="st">"+proj=lcc +lat_1=-30.9659996032715 +lat_2=-30.9659996032715 +lat_0=-30.9660034179688 +lon_0=-63.5670013427734 +a=6370000 +b=6370000"</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">surface</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">height</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">surface</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">height</span><span class="op">)</span>, proj <span class="op">=</span> <span class="va">proj_string</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-6-2.png" width="672"></p>
<p>You can actually pass any arbitrary function to <code>proj</code>. It
should take an iso object as returned by the isoband package with the
contour information and return the modified contours.</p>
</div>
<div class="section level4">
<h4 id="clipping">Clipping<a class="anchor" aria-label="anchor" href="#clipping"></a>
</h4>
<p>The <code>clip</code> argument takes a simple feature polygon and
clips the contours to the interior of the polygon. Clipping is done
after <code>proj</code> is applied.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">argentina</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"argentina"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">surface</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">height</span><span class="op">)</span>, proj <span class="op">=</span> <span class="va">proj_string</span>, clip <span class="op">=</span> <span class="va">argentina</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="on-the-fly-kriging">On the fly kriging<a class="anchor" aria-label="anchor" href="#on-the-fly-kriging"></a>
</h4>
<p>If everything fails and your data is not on a regular grid on any
coordinate system, then you can use kriging to interpolate it to a
regular grid and then plot it using contours. Setting the
<code>kriging</code> argument to<code>TRUE</code> uses {<a href="https://cran.r-project.org/package=kriging" class="external-link">kriging</a>} to
<em>krige</em> (is that a verb?) the data before computing the contours.
Here, as an example, the volcano dataset is sampled and perturbed to
create a dataset of irregularly spaced points. Using kriging,
<code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> can recover the general shape.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">some_volcano</span> <span class="op">&lt;-</span> <span class="va">volcano</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">.N</span>, <span class="va">.N</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span>   <span class="co"># select 70% of the points</span></span>
<span><span class="va">some_volcano</span><span class="op">[</span>, <span class="va">Var1</span> <span class="op">:=</span> <span class="va">Var1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">.N</span><span class="op">)</span><span class="op">]</span>    <span class="co"># add some random noise</span></span>
<span><span class="va">some_volcano</span><span class="op">[</span>, <span class="va">Var2</span> <span class="op">:=</span> <span class="va">Var2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">.N</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">some_volcano</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">some_volcano</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, kriging <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-8-2.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="unequal-breaks-between-facets">Unequal <code>breaks</code> between facets<a class="anchor" aria-label="anchor" href="#unequal-breaks-between-facets"></a>
</h4>
<p>ggplot2’s <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour_filled()</a></code> computes breaks using
all the data. This is great because it means that breaks are consistent
between panels when using <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid()</a></code>. But if you want to
compute breaks separately for each panel, you can use
<code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code>’s <code>global.breaks</code>
argument.</p>
<p>With the default, separation between levels is always the same. Good
for comparison, but in this case the panel on the left lacks detail.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">300</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">lev</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>With <code>global.breaks = FALSE</code>, binwidth is no longer the
same in each panel and now you can see more detail in the leftmost
panel.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">300</span><span class="op">)</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span>global.breaks <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">lev</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>All of these features are also available to regular contours in the
<code><a href="../reference/geom_contour2.html">geom_contour2()</a></code> function.</p>
</div>
<div class="section level4">
<h4 id="computed-variables">Computed variables<a class="anchor" aria-label="anchor" href="#computed-variables"></a>
</h4>
<p>Like <code>ggplot::geom_contour_filled()</code>,
<code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> computes several relevant variables.
The two most important ones are <code>level_mid</code> (also called
<code>int.level</code> for backwards compatibility reasons) and
<code>level</code>. The former (the default) is a numeric value that
corresponds to the midpoint of the levels while the latter is an ordered
factor that represents the range of the contour.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-11-2.png" width="672"></p>
<p>A big difference between the two variables is that one is compatible
with continuous scales while the other only works with discrete scales.
The advantage of using <code>level_mid</code> is that it preserves the
actual continuous nature of the data, which allows the use of meaningful
continuous scales such as <code><a href="../reference/scale_divergent.html">scale_fill_divergent()</a></code> and
results in proper colours when breaks are not equally spaced. The
disadvantage is that the scale function has no information about the
discretisation, and thus is very hard to use <em>synchronise</em> the
breaks that define the levels of the contours and the breaks shown in
the color guide.</p>
<p>A third important computed variable is <code>level_d</code>, which is
identical to <code>level</code> but forces the scale to match the breaks
in the data automatically.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">level_d</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>See the <a href="#discretised_scale">discretised_scale</a> section
for a way of using continuous sales for discretised data.</p>
</div>
</div>
<div class="section level3">
<h3 id="geom_text_contour-and-geom_label_contour">geom_text_contour and geom_label_contour<a class="anchor" aria-label="anchor" href="#geom_text_contour-and-geom_label_contour"></a>
</h3>
<p>Labelling contours is also a problematic aspect of
<code>ggplot2</code>. <code><a href="../reference/geom_text_contour.html">geom_text_contour()</a></code> and
<code><a href="../reference/geom_text_contour.html">geom_label_contour()</a></code> can be use to automatically add text
or labels to the flattest part of a contour.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>By default it labels every 2nd contour (this can be changed by the
<code>skip</code> parameter) and it rotates to follow the angle of the
contour (this is not available on <code><a href="../reference/geom_text_contour.html">geom_label_contour()</a></code>).
Since in some datasets there can be very small contours that should not
be labelled for clarity, the <code>min.size</code> argument specifies
the minimum points a contour has to have in order to be labelled.</p>
<p>Notice how labels are drawn on top of contours? The problem is that
<code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour()</a></code> doesn’t know it’s being labelled;
<code><a href="../reference/geom_text_contour.html">geom_text_contour()</a></code> addresses this issue by allowing you to
draw a stroke around the text.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour2.html">geom_contour2</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span>stroke <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>You can have full control over where labels are placed with the
<code>label.placer</code> argument. It takes a function that takes a
vector of x and y values and returns a logical vector of the same length
that indicate the points where labels should be. There are 5 build in
placement functions:</p>
<ul>
<li><p><code><a href="../reference/label_placers.html">label_placer_flattest()</a></code>: The default. It computes
the curvature and the angle at each points and then selects the point
which minimizes the sum of both numbers. Therefore, it tries to label
the flattest and most horizontal part of the contour.</p></li>
<li><p><code><a href="../reference/label_placers.html">label_placer_fraction()</a></code>: It takes a vector of
numbers ranging from 0 to 1 representing where tu put the label in
relation to the length of the contour. That is, using 0.5 means to put
the label at the midpoint.</p></li>
<li><p><code><a href="../reference/label_placers.html">label_placer_n()</a></code>: Places <code>n</code> labels
approximately equally spaced along the contour.</p></li>
<li><p><code><a href="../reference/label_placers.html">label_placer_random()</a></code>: It puts the label in random
places. ¯\_(ツ)_/¯ .</p></li>
<li><p><code><a href="../reference/label_placers.html">label_placer_all()</a></code>: It puts the label at every
point. Probably is best not to use it.</p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour2.html">geom_contour2</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_text_contour.html">geom_text_contour</a></span><span class="op">(</span>stroke <span class="op">=</span> <span class="fl">0.2</span>, label.placer <span class="op">=</span> <span class="fu"><a href="../reference/label_placers.html">label_placer_random</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="geom_contour_tanaka">geom_contour_tanaka<a class="anchor" aria-label="anchor" href="#geom_contour_tanaka"></a>
</h3>
<p>Illuminated contours (aka Tanaka contours) use varying brightness and
width to create an illusion of relief. This can help distinguishing
between concave and convex areas (local minimums and maximums),
specially in black and white plots. It also allows for photocopy safe
plots with divergent colour palettes, and it just looks cool.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_tanaka.html">geom_contour_tanaka</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="stat_subset">stat_subset<a class="anchor" aria-label="anchor" href="#stat_subset"></a>
</h3>
<p><code>metR</code> also has <code><a href="../reference/stat_subset.html">stat_subset()</a></code> which makes a
subset of the data according to the <code>subset</code> aesthetic. This
makes it possible to show only part of the data in one geom without
needing to specify a <code>data</code> argument (specially useful if the
data being plotted is the result of a long pipe and not actually
assigned to a <code>data.frame</code>). It has a somewhat limited use in
that it cannot perform further statistical transformations of the
data.</p>
<p>For example, it can be used if you have a correlation field and want
to mark only the points with significant correlations:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">geopotential</span><span class="op">)</span>    <span class="co"># geopotential height at 700hPa for the Southern Hemisphere. </span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">geopotential</span><span class="op">[</span>, <span class="va">gh.base</span> <span class="op">:=</span> <span class="va">gh</span><span class="op">[</span><span class="va">lon</span> <span class="op">==</span> <span class="fl">120</span> <span class="op">&amp;</span> <span class="va">lat</span> <span class="op">==</span> <span class="op">-</span><span class="fl">50</span><span class="op">]</span>, by <span class="op">=</span> <span class="va">date</span><span class="op">]</span><span class="op">[</span></span>
<span>    , <span class="fu">.</span><span class="op">(</span>correlation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">gh.base</span>, <span class="va">gh</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">correlation</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/stat_subset.html">stat_subset</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="va">correlation</span> <span class="op">&gt;</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                geom <span class="op">=</span> <span class="st">"point"</span>, size <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>Another possible use it to quickly mask missing values.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">volcano</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span>, z <span class="op">=</span> <span class="va">value.gap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span>na.fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/stat_subset.html">stat_subset</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">value.gap</span><span class="op">)</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"raster"</span>, </span>
<span>                fill <span class="op">=</span> <span class="st">"#a56de2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="geom_vector-and-geom_arrow">geom_vector and geom_arrow<a class="anchor" aria-label="anchor" href="#geom_vector-and-geom_arrow"></a>
</h3>
<p>Plotting arrows can be a pain. Again, the ‘canonical’ way of plotting
vectors is to use <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment()</a></code> and specify
<code>x</code>, <code>y</code>, <code>xend</code> and <code>yend</code>
aesthetics which can be a lot of typing when one has the data on
location and displacement (or velocity). Instead, <code>metR</code>‘s
<code><a href="../reference/geom_arrow.html">geom_vector()</a></code> and <code><a href="../reference/geom_arrow.html">geom_arrow()</a></code> draw vectors
defined by their lateral displacements (dx, dy) or their magnitude and
angle. It also has some useful parameters like <code>min.mag</code>,
which controls the minimum magnitude for an arrow to be drawn (useful
for highlighting only areas of strong ’flow’) and <code>skip</code>,
which draws only the nth arrow in the x and y directions.</p>
<p>Both geoms are essentially the same, except that
<code><a href="../reference/geom_arrow.html">geom_arrow()</a></code> defaults to preserving direction in coordinate
transformations and regardless of the plot aspect ratio. This is
recommended if the arrows are meant to convey the direction of the flow
in each point instead of being a description of the shape of the flow
related to the plot coordinates.</p>
<p>So, as an example, we can plot the temperature gradient like
this:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temperature</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"t.dx"</span>, <span class="st">"t.dy"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="../reference/Derivate.html">Derivate</a></span><span class="op">(</span><span class="va">air.z</span> <span class="op">~</span> <span class="va">lon</span> <span class="op">+</span> <span class="va">lat</span>,</span>
<span>                                            cyclical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            by <span class="op">=</span> <span class="va">lev</span><span class="op">]</span></span>
<span></span>
<span><span class="op">(</span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">500</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="../reference/geom_arrow.html">geom_vector</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="va">t.dx</span>, dy <span class="op">=</span> <span class="va">t.dy</span><span class="op">)</span>, skip.x <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                    skip.y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="../reference/scale_mag.html">scale_mag</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<p>In the above example, t.dx and t.dy represent displacements in the
same units as the x and y dimension, so using <code><a href="../reference/geom_arrow.html">geom_vector()</a></code>
each arrow points perpendicular to the contours even if we change the
coordinate system.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-20-1.png" width="672"></p>
<p>But if we want to plot how the (horizontal) direction changes with
height it makes more sense to use <code><a href="../reference/geom_arrow.html">geom_arrow()</a></code> (or
<code>geom_vector(preserve.dir = TRUE)</code>)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lon</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/between.html" class="external-link">%between%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">lat</span> <span class="op">==</span> <span class="op">-</span><span class="fl">50</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lev</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/geom_arrow.html">geom_arrow</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="fu"><a href="../reference/spherical.html">dx</a></span><span class="op">(</span><span class="va">t.dx</span>, <span class="va">lat</span><span class="op">)</span>, dy <span class="op">=</span> <span class="fu"><a href="../reference/spherical.html">dy</a></span><span class="op">(</span><span class="va">t.dy</span><span class="op">)</span><span class="op">)</span>, skip <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_level</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_mag.html">scale_mag</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<p>In this case, an arrow at a 45° angle represents temperature gradient
from the Southwest regardless of the <code>x</code> and <code>y</code>
scales.</p>
<p>The <code>start</code> and <code>direction</code> arguments adjust
the behaviour of the arrows. This is useful for working with winds in
the meteorological standard (in which 0° means wind from the North and
90° means wind from the East).</p>
</div>
<div class="section level3">
<h3 id="geom_streamline">geom_streamline<a class="anchor" aria-label="anchor" href="#geom_streamline"></a>
</h3>
<p>Streamlines are paths tangential to a vector field and provide an
intuitive way of visualizing vector fields.
<code><a href="../reference/geom_streamline.html">geom_streamline()</a></code> computes streamlines via Euler
integration.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">500</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="../reference/geom_streamline.html">geom_streamline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="va">t.dy</span>, dy <span class="op">=</span> <span class="op">-</span><span class="va">t.dx</span><span class="op">)</span>, L <span class="op">=</span> <span class="fl">10</span>, res <span class="op">=</span> <span class="fl">2</span>,   </span>
<span>                     arrow.length <span class="op">=</span> <span class="fl">0.3</span>, xwrap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">360</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-22-1.png" width="672"></p>
<p>There are several parameters that control the feel of the result.
<code>L</code> and <code>res</code> control the length and resolution,
while the <code>skip</code> parameters change the amount of the
streamlines. More in depth control over the simulation can be
accomplished by the <code>S</code> and <code>dt</code> parameters.</p>
<p>Since streamlines imply a tight relationship between the vector field
and the spatial dimensions, it’s important that their units are
compatible. A wind field in m/s in a longitude-latitude grid should
first be converted into degrees/s. The functions <code><a href="../reference/spherical.html">dlon()</a></code> and
<code><a href="../reference/spherical.html">dlat()</a></code> are an easy way of doing this. This tight coupling
also means that they are robust to coordinate transformations.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<p><code><a href="../reference/geom_streamline.html">stat_streamline()</a></code> computes three useful variables.
<code>step</code> is the integration step, and <code>dx</code> and
<code>dy</code> are the components of the vector field at each point.
They can be used to visualize information about the field in each point,
and to give a sense of direction without arrows.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">500</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_streamline.html">geom_streamline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>dx <span class="op">=</span> <span class="va">t.dy</span>, dy <span class="op">=</span> <span class="op">-</span><span class="va">t.dx</span>, size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">step</span><span class="op">)</span>, </span>
<span>                        alpha <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">step</span><span class="op">)</span>,</span>
<span>                        color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">dx</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">dy</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, arrow <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                    L <span class="op">=</span> <span class="fl">10</span>, res <span class="op">=</span> <span class="fl">2</span>, xwrap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">360</span><span class="op">)</span>, lineend <span class="op">=</span> <span class="st">"round"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html" class="external-link">scale_alpha</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="scales">Scales<a class="anchor" aria-label="anchor" href="#scales"></a>
</h2>
<div class="section level3">
<h3 id="discretised_scale">discretised_scale()<a class="anchor" aria-label="anchor" href="#discretised_scale"></a>
</h3>
<p>The use of <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour()</a></code> and
<code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> generates a problem because those geoms
implicitly discretise a continuous variable, but it’s hard to
communicate that discretisation to the colour scale. In particular, it
would be handy to show a discretised version of the colour scale in
which the values labelled are in sync with the contour levels.</p>
<p>One way of achieving this is to use the <code>level</code> stat,
which –as discussed previously– is a discrete variable. With that, one
can use <code><a href="https://ggplot2.tidyverse.org/reference/guide_coloursteps.html" class="external-link">ggplot2::guide_colorsteps()</a></code> to get a nice looking
guide.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_coloursteps.html" class="external-link">guide_colorsteps</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<p>This can work, but this example shows its limitations. Since the
scale has no real understanding of the underlying numbers, breaks and
colours are always distributed evenly even when they shouldn’t. For the
same reason it’s also not possible to use diverging colour scales with a
set midpoint.</p>
<p>For that, the solution is to use
<code><a href="../reference/discretised_scale.html">scale_fill_discretised()</a></code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/discretised_scale.html">scale_fill_discretised</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-26-1.png" width="672"></p>
<p>This type of scale understand discrete values that have an underlying
continuous nature. This means that the scale can be modified by
referencing the continuous values. For example, using a divergent scale
and setting the midpoint.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lev</span> <span class="op">==</span> <span class="fl">300</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lon</span>, <span class="va">lat</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">8</span>, <span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/discretised_scale.html">scale_fill_divergent_discretised</a></span><span class="op">(</span>midpoint <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="other-scales">Other scales<a class="anchor" aria-label="anchor" href="#other-scales"></a>
</h3>
<p>Many meteorological fields are defined in a longitude×latitude×level
grid, so <code>metR</code> includes scales for each dimension. These are
glorified wrappers around <code>scale_*_continuous()</code> with
sensible defaults and, in the case of <code>scale_*_level()</code>, the
implementation of <code><a href="../reference/reverselog_trans.html">reverselog_trans()</a></code>.</p>
<p>There are also <code><a href="../reference/scale_divergent.html">scale_color_divergent()</a></code> and
<code><a href="../reference/scale_divergent.html">scale_fill_divergent()</a></code> which are wrappers around
<code>scale_*_gradient2()</code> but with sane default colours for
positive and negative values –particularly useful for plotting anomaly
values.</p>
<p>To see how this scales work, let’s visualize the vertical
distribution of temperature anomalies from the zonal mean.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot made with base ggplot</span></span>
<span><span class="op">(</span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">temperature</span><span class="op">[</span><span class="va">lon</span> <span class="op"><a href="../reference/logic.html">%~%</a></span> <span class="fl">180</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">lat</span>, <span class="va">lev</span>, z <span class="op">=</span> <span class="va">air.z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="../reference/geom_contour2.html">geom_contour2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">level</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<p>While this is fine, since pressure levels are roughly proportional to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi mathvariant="normal">e</mi><mrow><mo>−</mo><mi>z</mi></mrow></msup><annotation encoding="application/x-tex">\mathrm{e}^{-z}</annotation></semantics></math>
in meteorology we usually plot the vertical coordinate as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">-\log(p)</annotation></semantics></math>.
However, while ggplot2 has <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10()</a></code> and
<code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse()</a></code>, they don’t work together.
<code>metR</code> defines the new transformation
<code><a href="../reference/reverselog_trans.html">reverselog_trans()</a></code> that can be used with any scale but that
is the default for <code>scale_*_level()</code>.</p>
<p>On the other hand, <code>scale_*_latitude()</code> (and
<code>scale_*_longitude()</code>) not only defaults <code>expand</code>
to <code>c(0, 0)</code>, but also has a <code>ticks</code> argument that
specifies the spacing of breaks between -90 and 90 in the case of
<code>scale_*_latitude()</code>, and between 0 and 360 in the case of
<code>scale_*_longitude()</code>.</p>
<p>These scales default to printing no label, since usually the
dimensions are understood by the shape of the plot.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_level</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_latitude</a></span><span class="op">(</span>ticks <span class="op">=</span> <span class="fl">15</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/scale_divergent.html">scale_color_divergent</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-29-1.png" width="672"></p>
<p>Note: <code>scale_*_longitude()</code> (currently) assumes the data
goes from 0° to 360° but puts labels between -180° and 180°. This very
idiosyncratic choice stems from the fact that model output is usually in
the [0; 360) range but it’s easier to read maps in the (-180; 180]
range. This may change in the future.</p>
</div>
</div>
<div class="section level2">
<h2 id="other-goodies">Other goodies<a class="anchor" aria-label="anchor" href="#other-goodies"></a>
</h2>
<div class="section level3">
<h3 id="geom_relief">geom_relief<a class="anchor" aria-label="anchor" href="#geom_relief"></a>
</h3>
<p>This geom produces a shaded relief of the data. It doesn’t really map
the data per se, but it provides an intuitive representation of hills
and valleys that can be used as a background for plotting actual
data.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">volcano</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/geom_relief.html">geom_relief</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-30-1.png" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Elio Campitelli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
